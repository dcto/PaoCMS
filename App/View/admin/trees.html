{% extends 'admin/layout.html' %}

{% block head %}
<link href="{{asset('/plugins/bootstrap-gtreetable/bootstrap-gtreetable.css')}}" rel="stylesheet">
<script type="text/javascript" src="{{ asset('/plugins/bootstrap-gtreetable/bootstrap-gtreetable.js') }}"></script>
<script type="text/javascript" src="{{ asset('/plugins/bootstrap-gtreetable/languages/bootstrap-gtreetable.zh-CN.js') }}"></script>
<script type="text/javascript" src="{{ asset('/plugins/js/jquery-ui.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('/plugins/js/jquery.browser.min.js') }}"></script>
{% endblock %}

{% block script %}
<script type="text/javascript">


    $(function() {

        if(URI().hash()=='#trees'){
            var pid = '{{ request.get('pid') }}';
            $('#gtreetable').gtreetable({
                "language": "{{ config.language }}",
                "nodeIndent": 16,
                "inputWidth": "60%",
                "cache": 0,
                "actions": [
                    {
                        name: '{{ lang.enable }}',
                        event: function (oNode) {
                            $.post('{{ url("@trees_update") }}', {id: oNode.getId(), status: 1}, function (json) {
                            });
                        }
                    },
                    {
                        name: '{{ lang.disable }}',
                        event: function (oNode) {
                            $.post('{{ url("@trees_update") }}', {id: oNode.getId(), status: 0}, function (json) {
                            });
                        }
                    },

                ],
                "source": function (id) {
                    var data = {
                        type: 'POST',
                        url: URI('{{ url('@trees') }}'),
                        data: {'pid': pid, 'id': id},
                        dataType: 'json',
                        success: function (json) {
                        },
                        error: function (XMLHttpRequest) {
                            alert(XMLHttpRequest.status + ': ' + XMLHttpRequest.responseText);
                        }
                    };
                    return data;
                },

                "onSave": function (oNode) {
                    return {
                        type: 'POST',
                        url: !oNode.isSaved() ? '{{ url('@trees_create') }}' : URI('{{ url('@trees_update') }}'),
                        data: {
                            id: oNode.getId(),
                            pid: oNode.getParent(),
                            name: oNode.getName(),
                            position: oNode.getInsertPosition(),
                            related: oNode.getRelatedNodeId()
                        },
                        dataType: 'json',
                        error: function (XMLHttpRequest) {
                            $.pao.alert(XMLHttpRequest.responseText, {icon: 2});
                        }
                    };
                },
                "onDelete": function (oNode) {
                    return {
                        type: 'POST',
                        url: URI('{{ url('@trees_delete') }}').addSearch({'id': oNode.getId()}).toString(),
                        dataType: 'json',
                        error: function (XMLHttpRequest) {
                            $.pao.alert(XMLHttpRequest.responseText, {icon: 1});
                        }
                    };
                },
                "draggable": true,
                "onMove": function (oSource, oDestination, position) {
                    return {
                        type: 'POST',
                        url: URI('{{ url('@trees_update') }}').addSearch({'id': oSource.getId()}).toString(),
                        data: {
                            pid: oDestination.getParent(),
                            related: oDestination.getId(),
                            position: position
                        },
                        dataType: 'json',
                        error: function (XMLHttpRequest) {
                            $.pao.alert(XMLHttpRequest.responseText, {icon: 2});
                        }
                    };
                }

            });

            //$.pao.tab('trees');
            //alert();
            //return false;
        };


        $('#tabs').on('show.bs.tab', function (e) {
            if(e.target.hash=="#trees"){



            }//tab end
        });
    });



    $(document).ready(function() {
        $('.editable').editable();
    });
</script>
{% endblock %}

{% block content %}
    <!--TAB Panel start -->
    {% include 'admin/header.html' with({tab:{id:'trees',title:lang('menu.trees_list'), hide:'hide'}}) %}
    <!--TAB Panel end -->

<div class="row tab-content">

    <!--TAB create-->
    <div id="create" class="col-md-10 tab-pane col-center">
    <form action="{{ url('@trees_create') }}" method="POST" class="form-horizontal">
        <fieldset>
            <legend>{{ lang(ACTION)~title }}</legend>
            {{ forms.text('tag') }}
            {{ forms.text('name') }}
            {{ forms.radio('status',4) }}
            {{ forms.submit() }}
        </fieldset>
    </form>
    </div>
    <!--TAB create end-->

    <!--TAB update-->
    <div id="update" class="col-md-10 tab-pane col-center">
        <form action="{{ url('@trees_update') }}" method="POST" class="form-horizontal">
        </form>
    </div>
    <!--TAB update end-->

    <!--TAB trees-->
    <div id="trees" class="col-md-8 col-center tab-pane">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="btn-group-xs pull-right panel">
                    <!--
                    <a href="#" class="btn btn-success btn-create" data-do="create">{{ lang.create }}</a>
                    <a href="#" class="btn btn-primary btn-update" data-do="update">{{ lang.update }}</a>
                    <a href="#" class="btn btn-danger btn-delete" data-do="delete">{{ lang.delete }}</a>
                    -->
                </div>
                <div class="panel-title">{{ lang.menu.trees }}</div>
            </div>
            <div class="panel-body">
                <div id="gtree">
                    <table class="table gtreetable" id="gtreetable"><thead><tr><th>ROOT</th></tr></thead></table>
                </div>
            </div>
        </div>
    </div>
    <!--TAB trees end-->
    <!--TAB index-->
    <div id="index" class="tab-pane col-md-6 col-center active">
        <div id="table">
            <table class="table table-striped table-bordered table-hover table-list" cellspacing="0"
                   width="100%">
                <thead>
                <tr>
                    <th>{{lang.id}}</th>
                    <th>{{lang.tag}}</th>
                    <th>{{lang.name}}</th>
                    <th>{{lang.status}}</th>
                    <th class="text-center">{{lang.operate}}</th>
                </tr>
                </thead>
                <tbody>
                <form method="POST">
                    {% for v in trees %}
                        <tr>
                            <td>{{v.id}}</td>
                            <td>{{v.tag}}</td>
                            <td>{{v.name}}</td>
                            <td>{{forms.status(v.status, v.id)}}</td>
                            <td class="text-center">{{forms.operate(v.id, v.name, {name:'trees', title:lang('menu.trees_list'),url:url('@trees')~'?pid='~v.id~'#trees'})}}</td>
                        </tr>
                    {%endfor%}
                </form>
                </tbody>
            </table>

        </div>
</div>
{% endblock %}